import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as n,e as i}from"./app-ygFmrJeo.js";const l={},r=i(`<h1 id="tcp-udp-websocket-in-godot" tabindex="-1"><a class="header-anchor" href="#tcp-udp-websocket-in-godot"><span>tcp,udp,websocket in Godot</span></a></h1><h2 id="udpserver" tabindex="-1"><a class="header-anchor" href="#udpserver"><span>UDPServer</span></a></h2><p>用来接受来自其他程序的UDP数据包。是基于PacketPeerUDP封装的类。</p><h3 id="基础使用代码" tabindex="-1"><a class="header-anchor" href="#基础使用代码"><span>基础使用代码</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">extends</span><span style="color:#24292E;--shiki-dark:#E06C75;"> Node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">const</span><span style="color:#005CC5;--shiki-dark:#E5C07B;"> UDP_IP</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">const</span><span style="color:#005CC5;--shiki-dark:#E5C07B;"> UDP_PORT</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 4243</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> server</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">= </span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">UDPServer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">new</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _ready</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    set_process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">false</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    # </span><span style="color:#24292E;--shiki-dark:#E06C75;">开启监听端口</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#E5C07B;">UDP_PORT</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    set_process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">true</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _notification</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">what</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> what</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> NOTIFICATION_WM_CLOSE_REQUEST</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">        server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">stop</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">	    set_process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">false</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        get_tree</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">quit</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">_delta</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    # </span><span style="color:#24292E;--shiki-dark:#E06C75;">接受数据包</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">poll</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">is_connection_available</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> peer</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> PacketPeerUDP</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">take_connection</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> packet</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> PackedByteArray</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> peer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_packet</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Accepted peer: %s:%s&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="color:#24292E;--shiki-dark:#E5C07B;">peer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_packet_ip</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="color:#24292E;--shiki-dark:#E5C07B;">peer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_packet_port</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()])</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Received data: %s&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="color:#24292E;--shiki-dark:#E5C07B;">packet</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_string_from_utf8</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()])</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="packetpeerudp使用示例" tabindex="-1"><a class="header-anchor" href="#packetpeerudp使用示例"><span>PacketPeerUDP使用示例</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">extends</span><span style="color:#24292E;--shiki-dark:#E06C75;"> Node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> udp</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">= </span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">PacketPeerUDP</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">new</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> connected</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _ready</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    udp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">connect_to_host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">4242</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) # </span><span style="color:#24292E;--shiki-dark:#E06C75;">确定目标</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">delta</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !</span><span style="color:#6F42C1;--shiki-dark:#E06C75;">connected</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        # </span><span style="color:#24292E;--shiki-dark:#E06C75;">Try</span><span style="color:#24292E;--shiki-dark:#E06C75;"> to</span><span style="color:#24292E;--shiki-dark:#E06C75;"> contact</span><span style="color:#24292E;--shiki-dark:#E06C75;"> server</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">        udp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">put_packet</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;The answer is... 42!&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">to_utf8_buffer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()) # </span><span style="color:#24292E;--shiki-dark:#E06C75;">发包</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> udp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_available_packet_count</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Connected: %s&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> udp</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_packet</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_string_from_utf8</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()) # </span><span style="color:#24292E;--shiki-dark:#E06C75;">收包</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        connected</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="python-客户端代码" tabindex="-1"><a class="header-anchor" href="#python-客户端代码"><span>python 客户端代码</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> socket</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> json</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">opened_socket </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> socket.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(socket.</span><span style="color:#005CC5;--shiki-dark:#D19A66;">AF_INET</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, socket.</span><span style="color:#005CC5;--shiki-dark:#D19A66;">SOCK_DGRAM</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#D19A66;">UDP_IP</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#D19A66;">UDP_PORT</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 4243</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">lastChat </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">def</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    first </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    count </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> True</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> first: </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># 第一次可以将进程id发过去</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#61AFEF;">            send_chat</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;PIDs&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Greetings! 9527&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">            first </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> False</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        count </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">+=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#61AFEF;">        send_chat</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;CHAT&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">f</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Hello from python </span><span style="color:#005CC5;--shiki-dark:#D19A66;">{</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">count</span><span style="color:#005CC5;--shiki-dark:#D19A66;">}</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        time.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">sleep</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">3</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># Reduce CPU Usage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">def</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> send_chat</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#D19A66;font-style:inherit;--shiki-dark-font-style:italic;">chat</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">): </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># 发包</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    byte_message </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#005CC5;--shiki-dark:#56B6C2;"> bytes</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(json.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">dumps</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(chat), </span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    opened_socket.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">sendto</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(byte_message, (</span><span style="color:#005CC5;--shiki-dark:#D19A66;">UDP_IP</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">UDP_PORT</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">if</span><span style="color:#005CC5;--shiki-dark:#E06C75;"> __name__</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;__main__&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#61AFEF;">    main</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="tcp" tabindex="-1"><a class="header-anchor" href="#tcp"><span>TCP</span></a></h2><h3 id="streampeertcp" tabindex="-1"><a class="header-anchor" href="#streampeertcp"><span>StreamPeerTCP</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">extends</span><span style="color:#24292E;--shiki-dark:#E06C75;"> Node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> tcp_stream</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">= </span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">StreamPeerTCP</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">new</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> status</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;"> :</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">= </span><span style="color:#005CC5;--shiki-dark:#D19A66;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _ready</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">    status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_status</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">status</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    # </span><span style="color:#24292E;--shiki-dark:#E5C07B;">tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">bind</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">8083</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    connect_to_host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;127.0.0.1&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">50007</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">_delta</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">float</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">poll</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() # </span><span style="color:#24292E;--shiki-dark:#E06C75;">需要手动拉取socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">，</span><span style="color:#24292E;--shiki-dark:#E06C75;">否则status会一直是STATUS_CONNECTING</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> new_status</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> int</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_status</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> new_status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> status</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E06C75;"> new_status</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        match</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> status</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">            tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_NONE</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Disconnected from host.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">            tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_CONNECTING</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Connecting to host.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">            tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_CONNECTED</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Connected to host.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">            tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_ERROR</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Error with socket stream.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_CONNECTED</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> available_bytes</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> int</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_available_bytes</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> available_bytes</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">            print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;available bytes: &quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">available_bytes</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">            var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> data</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> Array</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_partial_data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">available_bytes</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">            # </span><span style="color:#24292E;--shiki-dark:#E06C75;">Check</span><span style="color:#24292E;--shiki-dark:#E06C75;"> for</span><span style="color:#24292E;--shiki-dark:#E06C75;"> read</span><span style="color:#24292E;--shiki-dark:#E06C75;"> error</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">            if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> OK</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Error getting data from stream: &quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">            else</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">                print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Data&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">1</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">].</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_string_from_utf8</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> connect_to_host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">String</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">port</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Connecting to %s:%d&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="color:#24292E;--shiki-dark:#E06C75;">host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">port</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    # </span><span style="color:#24292E;--shiki-dark:#E06C75;">Reset</span><span style="color:#24292E;--shiki-dark:#E06C75;"> status</span><span style="color:#24292E;--shiki-dark:#E06C75;"> so</span><span style="color:#24292E;--shiki-dark:#E06C75;"> we</span><span style="color:#24292E;--shiki-dark:#E06C75;"> can</span><span style="color:#24292E;--shiki-dark:#E06C75;"> tell</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> it</span><span style="color:#24292E;--shiki-dark:#E06C75;"> changes</span><span style="color:#24292E;--shiki-dark:#E06C75;"> to</span><span style="color:#24292E;--shiki-dark:#E06C75;"> error</span><span style="color:#24292E;--shiki-dark:#E06C75;"> again</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">    status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_NONE</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">connect_to_host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">host</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">port</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> OK</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Error connecting to host.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> send</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="color:#24292E;--shiki-dark:#E06C75;">PackedByteArray</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">-&gt;</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> bool</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> status</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATUS_CONNECTED</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Error: Stream is not currently connected.&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> error</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> int</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> tcp_stream</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">put_data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">data</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> error</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#6F42C1;--shiki-dark:#E06C75;"> OK</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Error writing to stream: &quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">error</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="python-客户端代码-1" tabindex="-1"><a class="header-anchor" href="#python-客户端代码-1"><span>python 客户端代码</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> socket</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> time</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># address = (&#39;127.0.0.1&#39;, 8083)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">s </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> socket.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(socket.</span><span style="color:#005CC5;--shiki-dark:#D19A66;">AF_INET</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, socket.</span><span style="color:#005CC5;--shiki-dark:#D19A66;">SOCK_STREAM</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">s.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">bind</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="color:#032F62;--shiki-dark:#98C379;">&#39;127.0.0.1&#39;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">50007</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#最大连接数</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">s.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">listen</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">5</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">#客户处理线程</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">def</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> handle_client</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#D19A66;font-style:inherit;--shiki-dark-font-style:italic;">client_socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">: socket.socket):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">    # request = client_socket.recv(1024)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">    # print(&quot;[*] Received: %s&quot; % request)</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">    #向客户端返回数据</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    try</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        client_socket.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">send</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;hi~&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">encode</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    except</span><span style="color:#005CC5;--shiki-dark:#ABB2BF;"> ConnectionAbortedError</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#D73A49;--shiki-dark:#C678DD;">f</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Disconnect with </span><span style="color:#005CC5;--shiki-dark:#D19A66;">{</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">client_socket.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">getpeername</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="color:#005CC5;--shiki-dark:#D19A66;">}</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    time.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">sleep</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">0.5</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">while</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> True</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">    #等待客户连接，连接成功后，将socket对象保存到client，将细节数据等保存到addr</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    client, addr </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> s.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">accept</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#56B6C2;">    print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;[*] Acception connection from </span><span style="color:#005CC5;--shiki-dark:#D19A66;">%s</span><span style="color:#032F62;--shiki-dark:#98C379;">:</span><span style="color:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> (addr[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">],addr[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">1</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> True</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">        # client_handler = threading.Thread(target=handle_client,args=(client,))</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">        # client_handler.start()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#61AFEF;">        handle_client</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(client)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="websocket" tabindex="-1"><a class="header-anchor" href="#websocket"><span>Websocket</span></a></h2><h3 id="websocketpeer" tabindex="-1"><a class="header-anchor" href="#websocketpeer"><span>WebsocketPeer</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">extends</span><span style="color:#24292E;--shiki-dark:#E06C75;"> Node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> socket</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> WebSocketPeer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">@</span><span style="color:#24292E;--shiki-dark:#E06C75;">onready</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> send_button</span><span style="color:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> Button</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E06C75;"> $Button</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _ready</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">connect_to_url</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;ws://localhost:5000&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    send_button</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E5C07B;">pressed</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">on_pressed</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> _process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">_delta</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">poll</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> state</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_ready_state</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> state</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> WebSocketPeer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATE_OPEN</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        while</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_available_packet_count</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">            var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> pkt</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_packet</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">            print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Packet: &quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">pkt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">            $RichTextLabel</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">text</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;Packet: %s&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> pkt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_string_from_utf8</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">    elif</span><span style="color:#24292E;--shiki-dark:#E06C75;"> state</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> WebSocketPeer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATE_CLOSING</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        # </span><span style="color:#24292E;--shiki-dark:#E06C75;">Keep</span><span style="color:#24292E;--shiki-dark:#E06C75;"> polling</span><span style="color:#24292E;--shiki-dark:#E06C75;"> to</span><span style="color:#24292E;--shiki-dark:#E06C75;"> achieve</span><span style="color:#24292E;--shiki-dark:#E06C75;"> proper</span><span style="color:#24292E;--shiki-dark:#E06C75;"> close</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        pass</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">    elif</span><span style="color:#24292E;--shiki-dark:#E06C75;"> state</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> WebSocketPeer</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#005CC5;--shiki-dark:#E06C75;">STATE_CLOSED</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> code</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_close_code</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        var</span><span style="color:#24292E;--shiki-dark:#E06C75;"> reason</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="color:#24292E;--shiki-dark:#E5C07B;"> socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">get_close_reason</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;WebSocket closed with code: %d, reason %s. Clean: %s&quot;</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> %</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="color:#24292E;--shiki-dark:#E06C75;">code</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">reason</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">code</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="color:#005CC5;--shiki-dark:#D19A66;">1</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        set_process</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#005CC5;--shiki-dark:#D19A66;">false</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) # </span><span style="color:#24292E;--shiki-dark:#E06C75;">Stop</span><span style="color:#24292E;--shiki-dark:#E06C75;"> processing</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> on_pressed</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">    print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E5C07B;">$LineEdit</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">text</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">send_text</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E5C07B;">$LineEdit</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">text</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="python-客户端代码-2" tabindex="-1"><a class="header-anchor" href="#python-客户端代码-2"><span>python 客户端代码</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki shiki-themes github-light one-dark-pro" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> asyncio</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> websockets </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"># pip install websocket</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">async</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> def</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> server</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#D19A66;font-style:inherit;--shiki-dark-font-style:italic;">ws</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#D19A66;font-style:inherit;--shiki-dark-font-style:italic;">path</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    async</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> for</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> msg </span><span style="color:#D73A49;--shiki-dark:#C678DD;">in</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> ws:</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">        # msg = msg.decode(&quot;utf-8&quot;)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#D73A49;--shiki-dark:#C678DD;">f</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Msg from client: </span><span style="color:#005CC5;--shiki-dark:#D19A66;">{</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">msg</span><span style="color:#005CC5;--shiki-dark:#D19A66;">}</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        data </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> f</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Got our msg: </span><span style="color:#005CC5;--shiki-dark:#D19A66;">{</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">msg</span><span style="color:#005CC5;--shiki-dark:#D19A66;">}</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">encode</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#56B6C2;">        print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(data)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        await</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> ws.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">send</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">start_server </span><span style="color:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> websockets.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">serve</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(server, </span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#56B6C2;">print</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;Server started&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">asyncio.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">get_event_loop</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="color:#24292E;--shiki-dark:#61AFEF;">run_until_complete</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(start_server)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">asyncio.</span><span style="color:#24292E;--shiki-dark:#61AFEF;">get_event_loop</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="color:#24292E;--shiki-dark:#61AFEF;">run_forever</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="意外收获" tabindex="-1"><a class="header-anchor" href="#意外收获"><span>意外收获</span></a></h2><p>GDScript stores values in <code>Variant</code>, which is what allows GDScript to be dynamically typed. <code>Variant</code> has a 16 byte payload, with 4 bytes of information about what that payload is, so it is 20 bytes, but is padded to 24 bytes on a modern 64-bit system. So, a GDScript int is 3 times the size of <code>int64</code>. This may change with typed instructions in Godot 4+.</p><p>一个var占24bytes。如果声明了类型则只占类型所需的bytes。</p>`,22),p=[r];function e(o,k){return a(),n("div",null,p)}const d=s(l,[["render",e],["__file","tcp_udp_websocket in Godot.html.vue"]]),B=JSON.parse('{"path":"/gamedev/tcp_udp_websocket%20in%20Godot.html","title":"tcp,udp,websocket in Godot","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2023-11-02T00:00:00.000Z","sticky":false,"star":false,"comment":true,"category":["Blog"],"tag":["godot"],"description":"tcp,udp,websocket in Godot","head":[["meta",{"property":"og:url","content":"https://1e0nhardt.github.io/gamedev/tcp_udp_websocket%20in%20Godot.html"}],["meta",{"property":"og:site_name","content":"宁静致远"}],["meta",{"property":"og:title","content":"tcp,udp,websocket in Godot"}],["meta",{"property":"og:description","content":"tcp,udp,websocket in Godot"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-25T16:58:41.000Z"}],["meta",{"property":"article:author","content":"leonhardt"}],["meta",{"property":"article:tag","content":"godot"}],["meta",{"property":"article:published_time","content":"2023-11-02T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-25T16:58:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"tcp,udp,websocket in Godot\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-11-02T00:00:00.000Z\\",\\"dateModified\\":\\"2024-05-25T16:58:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"leonhardt\\",\\"url\\":\\"/intro.html\\"}]}"]]},"headers":[{"level":2,"title":"UDPServer","slug":"udpserver","link":"#udpserver","children":[{"level":3,"title":"基础使用代码","slug":"基础使用代码","link":"#基础使用代码","children":[]},{"level":3,"title":"PacketPeerUDP使用示例","slug":"packetpeerudp使用示例","link":"#packetpeerudp使用示例","children":[]},{"level":3,"title":"python 客户端代码","slug":"python-客户端代码","link":"#python-客户端代码","children":[]}]},{"level":2,"title":"TCP","slug":"tcp","link":"#tcp","children":[{"level":3,"title":"StreamPeerTCP","slug":"streampeertcp","link":"#streampeertcp","children":[]},{"level":3,"title":"python 客户端代码","slug":"python-客户端代码-1","link":"#python-客户端代码-1","children":[]}]},{"level":2,"title":"Websocket","slug":"websocket","link":"#websocket","children":[{"level":3,"title":"WebsocketPeer","slug":"websocketpeer","link":"#websocketpeer","children":[]},{"level":3,"title":"python 客户端代码","slug":"python-客户端代码-2","link":"#python-客户端代码-2","children":[]}]},{"level":2,"title":"意外收获","slug":"意外收获","link":"#意外收获","children":[]}],"git":{"createdTime":1713017268000,"updatedTime":1716656321000,"contributors":[{"name":"1e0nhardt","email":"huwkigane@gmail.com","commits":2}]},"readingTime":{"minutes":2.71,"words":812},"filePathRelative":"gamedev/tcp,udp,websocket in Godot.md","localizedDate":"2023年11月2日","excerpt":""}');export{d as comp,B as data};
